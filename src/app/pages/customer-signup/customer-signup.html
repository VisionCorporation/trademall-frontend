<section class="grid grid-cols-1 md:grid-cols-2">
  <div class="bg-[#E3E8E1] min-h-[45svh] md:min-h-screen flex flex-col items-center justify-center">
    <div>
      <h1 class="text-4xl sm:text-5xl mb-5 text-center md:text-left text-[#171717] tracking-tight">
        Create an account
      </h1>
      <div class="stepper mx-2.5 md:mx-0">
        <div
          class="step flex flex-col md:flex-row text-center px-0"
          [class.active]="currentStep >= 1"
        >
          <span class="circle">1</span>
          <p class="text-[15px] md:text-2xl leading-5">Email Options</p>
        </div>

        <div class="line"></div>

        <div
          class="step flex flex-col md:flex-row text-center px-0"
          [class.active]="currentStep >= 2"
        >
          <span class="circle">2</span>
          <p class="text-[15px] md:text-2xl leading-5">Email Verification</p>
        </div>

        <div class="line"></div>

        <div
          class="step flex flex-col md:flex-row text-center px-0"
          [class.active]="currentStep >= 3"
        >
          <span class="circle">3</span>
          <p class="text-[15px] md:text-2xl leading-5">Personal Details</p>
        </div>

        <div class="line"></div>

        <div
          class="step flex flex-col md:flex-row text-center px-0"
          [class.active]="currentStep >= 4"
        >
          <span class="circle">4</span>
          <p class="text-[15px] md:text-2xl leading-5">Password Creation</p>
        </div>
      </div>
    </div>
  </div>
  <div
    class="relative bg-white min-h-[55svh] md:min-h-screen flex flex-col items-center justify-center"
  >
    @if (currentStep === 1) {
      <div class="max-w-85 w-full z-50">
        <button
          class="bg-[#2E790E] rounded-lg p-3.75 hover:opacity-80 transition-opacity duration-200 ease-in text-white w-full flex items-center justify-center gap-2.5 mb-6.5 disabled:opacity-60 disabled:cursor-not-allowed"
          [disabled]="signupService.isSubmitting$ | async"
          [class.cursor-not-allowed]="signupService.isSubmitting$ | async"
        >
          <svg
            width="20"
            height="20"
            viewBox="0 0 20 20"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M19.6 10.2273C19.6 9.51819 19.5364 8.83639 19.4182 8.18179H10V12.05H15.3818C15.15 13.3 14.4455 14.3591 13.3864 15.0682V17.5773H16.6182C18.5091 15.8364 19.6 13.2727 19.6 10.2273Z"
              fill="white"
            />
            <path
              d="M10 20C12.7 20 14.9636 19.1045 16.6181 17.5773L13.3863 15.0682C12.4909 15.6682 11.3454 16.0227 10 16.0227C7.3954 16.0227 5.1909 14.2636 4.4045 11.9H1.0636V14.4909C2.7091 17.7591 6.0909 20 10 20Z"
              fill="white"
            />
            <path
              d="M4.4045 11.9C4.2045 11.3 4.0909 10.6591 4.0909 9.99999C4.0909 9.34089 4.2045 8.69999 4.4045 8.09999V5.50909H1.0636C0.3864 6.85909 0 8.38639 0 9.99999C0 11.6136 0.3864 13.1409 1.0636 14.4909L4.4045 11.9Z"
              fill="white"
            />
            <path
              d="M10 3.9773C11.4681 3.9773 12.7863 4.4818 13.8227 5.4727L16.6909 2.6045C14.9591 0.9909 12.6954 0 10 0C6.0909 0 2.7091 2.2409 1.0636 5.5091L4.4045 8.1C5.1909 5.7364 7.3954 3.9773 10 3.9773Z"
              fill="white"
            />
          </svg>
          Continue with Google
        </button>
        <div class="or-divider">
          <span class="text-xl text-[#1717174D]">or</span>
        </div>

        <div class="w-full">
          <form [formGroup]="emailForm">
            <label for="email" hidden>Email</label>
            <input
              type="email"
              id="email"
              name="email"
              placeholder="Enter your email"
              formControlName="email"
              autocomplete="off"
              class="block w-full border border-[#17171799] rounded-md py-3 px-5 placeholder:text-[#17171733]"
            />

            @if (
              emailForm.get('email')?.invalid &&
              (emailForm.get('email')?.dirty || emailForm.get('email')?.touched)
            ) {
              <span
                class="text-[#ff6b6b] mt-2 text-[15px] text-left customise-sub-title flex items-center gap-2"
              >
                <svg
                  width="18"
                  height="18"
                  viewBox="0 0 20 20"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M7.5 7.5L12 12M12 7.5L7.5 12M18.75 9.75C18.75 14.7206 14.7206 18.75 9.75 18.75C4.77944 18.75 0.75 14.7206 0.75 9.75C0.75 4.77944 4.77944 0.75 9.75 0.75C14.7206 0.75 18.75 4.77944 18.75 9.75Z"
                    stroke="#ff6b6b"
                    stroke-width="1.5"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                </svg>
                {{ emailErrorMessage() }}
              </span>
            }

            <button
              type="button"
              [disabled]="emailForm.invalid || (signupService.isSubmitting$ | async)"
              class="bg-[#171717] hover:opacity-80 transition-opacity duration-200 ease-in p-3.75 text-white w-full mt-5 rounded-lg disabled:opacity-60 disabled:cursor-not-allowed flex items-center justify-center gap-2"
              [class.cursor-not-allowed]="
                emailForm.invalid || (signupService.isSubmitting$ | async)
              "
              (click)="submitEmailForOtp()"
            >
              @if (signupService.isSubmitting$ | async) {
                <div class="loader"></div>
              }
              {{ (signupService.isSubmitting$ | async) ? 'Sending Code...' : ' Continue with Email' }}
            </button>
          </form>
        </div>
      </div>
    }
    @if (currentStep === 2) {
      <div class="sm:max-w-[90%] w-[90%] z-50">
        <p class="text-center md:text-lg text-[#AAAAAA] tracking-tight mb-10 sm:mb-12.5">
          Enter the verification code sent to {{ emailForm.value.email }}
        </p>
        <form [formGroup]="otpForm" class="flex items-center justify-center flex-col">
          <div
            class="flex items-center justify-between gap-2 md:gap-3 lg:gap-3 mb-6 sm:mb-7.5 max-w-150"
          >
            <input
              #otpInput
              type="text"
              inputmode="numeric"
              autocomplete="one-time-code"
              maxlength="1"
              formControlName="digit1"
              class="otp-input"
              (focus)="moveCursorToEnd($event)"
              (click)="moveCursorToEnd($event)"
              (input)="onOtpInput($event, 0)"
              (keydown)="onKeyDown($event, 0)"
              (paste)="onOtpPaste($event)"
            />

            <input
              #otpInput
              type="text"
              inputmode="numeric"
              autocomplete="one-time-code"
              maxlength="1"
              formControlName="digit2"
              class="otp-input"
              (focus)="moveCursorToEnd($event)"
              (click)="moveCursorToEnd($event)"
              (input)="onOtpInput($event, 1)"
              (keydown)="onKeyDown($event, 1)"
              (paste)="onOtpPaste($event)"
            />

            <input
              #otpInput
              type="text"
              inputmode="numeric"
              autocomplete="one-time-code"
              maxlength="1"
              formControlName="digit3"
              class="otp-input"
              (focus)="moveCursorToEnd($event)"
              (click)="moveCursorToEnd($event)"
              (input)="onOtpInput($event, 2)"
              (keydown)="onKeyDown($event, 2)"
              (paste)="onOtpPaste($event)"
            />

            <input
              #otpInput
              type="text"
              inputmode="numeric"
              autocomplete="one-time-code"
              maxlength="1"
              formControlName="digit4"
              class="otp-input"
              (focus)="moveCursorToEnd($event)"
              (click)="moveCursorToEnd($event)"
              (input)="onOtpInput($event, 3)"
              (keydown)="onKeyDown($event, 3)"
              (paste)="onOtpPaste($event)"
            />

            <input
              #otpInput
              type="text"
              inputmode="numeric"
              autocomplete="one-time-code"
              maxlength="1"
              formControlName="digit5"
              class="otp-input"
              (focus)="moveCursorToEnd($event)"
              (click)="moveCursorToEnd($event)"
              (input)="onOtpInput($event, 4)"
              (keydown)="onKeyDown($event, 4)"
              (paste)="onOtpPaste($event)"
            />

            <input
              #otpInput
              type="text"
              inputmode="numeric"
              autocomplete="one-time-code"
              maxlength="1"
              formControlName="digit6"
              class="otp-input"
              (focus)="moveCursorToEnd($event)"
              (click)="moveCursorToEnd($event)"
              (input)="onOtpInput($event, 5)"
              (keydown)="onKeyDown($event, 5)"
              (paste)="onOtpPaste($event)"
            />
          </div>

          <div class="flex max-w-150 w-full items-center justify-between text-[17px] md:text-xl">
            <span class="text-[#E23F3F]">
              {{ countdown$ | async }}
            </span>

            <p class="text-[#171717]">
              Didnâ€™t get the code?
              <button
                class="cursor-pointer"
                [disabled]="!(canResend$ | async)"
                [class.text-gray-400]="!(canResend$ | async)"
                [class.pointer-events-none]="!(canResend$ | async)"
                [class.text-[#2E790E]]="canResend$ | async"
                (click)="resendOtp()"
              >
                Resend
              </button>
            </p>
          </div>

          <button
            type="button"
            [disabled]="otpForm.invalid || (signupService.isSubmitting$ | async)"
            class="md:max-w-85 max-w-150 w-full bg-[#171717] hover:opacity-80 transition-opacity duration-200 ease-in p-3.75 text-white mt-5.5 rounded-lg disabled:cursor-not-allowed disabled:opacity-60 flex items-center justify-center gap-2"
            [class.cursor-not-allowed]="otpForm.invalid || (signupService.isSubmitting$ | async)"
            (click)="verifyOtpCode()"
          >
            @if (signupService.isSubmitting$ | async) {
              <div class="loader"></div>
            }
            {{ (signupService.isSubmitting$ | async) ? 'Verifying Email...' : 'Verify Email' }}
          </button>
        </form>
      </div>
    }
    @if (currentStep === 3) {
      <div class="max-w-85 w-full z-50">
        <div class="w-full">
          <form [formGroup]="personalForm">
            <label for="firstName" hidden>First Name</label>
            <input
              type="text"
              id="firstName"
              name="firstName"
              placeholder="Enter your First Name"
              autocomplete="off"
              formControlName="firstName"
              class="block w-full border border-[#17171799] rounded-md py-3 px-5 placeholder:text-[#17171733] mb-5"
            />

            <label for="lastName" hidden>Last Name</label>
            <input
              type="text"
              id="lastName"
              name="lastName"
              placeholder="Enter your Last Name"
              autocomplete="off"
              formControlName="lastName"
              class="block w-full border border-[#17171799] rounded-md py-3 px-5 placeholder:text-[#17171733] mb-5"
            />

            <label for="phoneNumber" hidden>Phone Number</label>
            <input
              type="tel"
              id="phoneNumber"
              name="phoneNumber"
              placeholder="Enter your Phone Number"
              autocomplete="off"
              formControlName="phoneNumber"
              (input)="formatPhoneNumber()"
              class="block w-full border border-[#17171799] rounded-md py-3 px-5 placeholder:text-[#17171733]"
            />

            @if (
              personalForm.get('phoneNumber')?.invalid &&
              (personalForm.get('phoneNumber')?.dirty || personalForm.get('phoneNumber')?.touched)
            ) {
              <span
                class="text-[#ff6b6b] mt-2 text-[15px] text-left customise-sub-title flex items-center gap-2"
              >
                <svg
                  width="18"
                  height="18"
                  viewBox="0 0 20 20"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M7.5 7.5L12 12M12 7.5L7.5 12M18.75 9.75C18.75 14.7206 14.7206 18.75 9.75 18.75C4.77944 18.75 0.75 14.7206 0.75 9.75C0.75 4.77944 4.77944 0.75 9.75 0.75C14.7206 0.75 18.75 4.77944 18.75 9.75Z"
                    stroke="#ff6b6b"
                    stroke-width="1.5"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                </svg>
                {{ phoneErrorMessage() }}
              </span>
            }

            <button
              type="button"
              [disabled]="personalForm.invalid"
              class="bg-[#171717] hover:opacity-80 transition-opacity duration-200 ease-in p-3.75 text-white w-full mt-5 rounded-lg disabled:cursor-not-allowed disabled:opacity-60"
              [class.cursor-not-allowed]="personalForm.invalid"
              (click)="nextStep()"
            >
              Continue
            </button>
          </form>
        </div>
      </div>
    }
    @if (currentStep === 4) {
      <div class="max-w-85 w-full z-50">
        <div class="w-full">
          <form [formGroup]="passwordForm">
            <label for="password" hidden>Password</label>
            <input
              type="password"
              id="password"
              name="password"
              placeholder="Create a Password"
              formControlName="password"
              class="block w-full border border-[#17171799] rounded-md py-3 px-5 placeholder:text-[#17171733]"
            />

            @if (
              passwordForm.get('password')?.invalid &&
              (passwordForm.get('password')?.dirty || passwordForm.get('password')?.touched)
            ) {
              <span
                class="text-[#ff6b6b] mt-2 text-[15px] text-left customise-sub-title flex items-center gap-2"
              >
                <svg
                  width="18"
                  height="18"
                  viewBox="0 0 20 20"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M7.5 7.5L12 12M12 7.5L7.5 12M18.75 9.75C18.75 14.7206 14.7206 18.75 9.75 18.75C4.77944 18.75 0.75 14.7206 0.75 9.75C0.75 4.77944 4.77944 0.75 9.75 0.75C14.7206 0.75 18.75 4.77944 18.75 9.75Z"
                    stroke="#ff6b6b"
                    stroke-width="1.5"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                </svg>
                {{ passwordErrorMessage() }}
              </span>
            }

            <label for="confirmPassword" hidden>Confirm Password</label>
            <input
              type="password"
              id="confirmPassword"
              name="confirmPassword"
              placeholder="Confirm your Password"
              formControlName="confirmPassword"
              class="block w-full border border-[#17171799] rounded-md py-3 px-5 placeholder:text-[#17171733] mt-5"
            />

            @if (
              passwordForm.get('confirmPassword')?.invalid &&
              (passwordForm.get('confirmPassword')?.dirty ||
                passwordForm.get('confirmPassword')?.touched)
            ) {
              <span
                class="text-[#ff6b6b] mt-2 text-[15px] text-left customise-sub-title flex items-center gap-2"
              >
                <svg
                  width="18"
                  height="18"
                  viewBox="0 0 20 20"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M7.5 7.5L12 12M12 7.5L7.5 12M18.75 9.75C18.75 14.7206 14.7206 18.75 9.75 18.75C4.77944 18.75 0.75 14.7206 0.75 9.75C0.75 4.77944 4.77944 0.75 9.75 0.75C14.7206 0.75 18.75 4.77944 18.75 9.75Z"
                    stroke="#ff6b6b"
                    stroke-width="1.5"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                </svg>
                {{ confirmPasswordErrorMessage() }}
              </span>
            }

            <button
              type="button"
              [disabled]="passwordForm.invalid || (signupService.isSubmitting$ | async)"
              class="bg-[#171717] hover:opacity-80 transition-opacity duration-200 ease-in p-3.75 text-white w-full mt-5 rounded-lg disabled:cursor-not-allowed disabled:opacity-60 flex items-center justify-center gap-2"
              [class.cursor-not-allowed]="
                passwordForm.invalid || (signupService.isSubmitting$ | async)
              "
              (click)="registerCustomer()"
            >
              @if (signupService.isSubmitting$ | async) {
                <div class="loader"></div>
              }
              {{ (signupService.isSubmitting$ | async) ? 'Creating Account...' : 'Create Account' }}
            </button>
          </form>
        </div>
      </div>
    }
    <p
      class="absolute bottom-7 md:bottom-auto md:top-14.5 text-center lg:right-12.5 text-[17px] md:text-xl z-10 px-4"
    >
      Already have an account?
      <a class="text-[#2E790E] py-3 px-3" routerLink="/login">Log In</a>
    </p>
  </div>
</section>
